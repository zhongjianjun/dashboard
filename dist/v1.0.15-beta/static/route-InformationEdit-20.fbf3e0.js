webpackJsonp([20],{582:function(e,t,a){"use strict";function InformationEdit(e){var t=e.dispatch,n=e.information,r=e.app,o={breadcrumbs:[{name:"首页"},{name:"资讯管理"},{name:"资讯编辑"}]},s={selectChannels:r.selectChannels,selectColumns:r.selectColumns,labellist:n.labellist,uploadToken:n.uploadToken,isUpload:n.isUpload,formSureButton:n.formSureButton,channel_id:n.channel_id,column_id:n.column_id,image:n.image,intro:n.intro,is_reco:n.is_reco,keywords:n.keywords,label_ids:n.label_ids,name:n.name,shows:n.shows,sort_order:n.sort_order,summary:n.summary,id:n.id,changeSelectChannels:function(e){t(a.i(p.d)(e)),t(changeChannelId(e)),a.i(m.a)(function(){return t(a.i(h.a)({channel_id:e,column_id:"0"}))})},changeSelectcolumn:function(e){a.i(m.a)(function(){return t(a.i(h.a)(e))})},uploadImg:function(e){t(a.i(h.b)(e))},onCancel:function(){u.b.push("/information")},onOk:function(e){a.i(m.a)(function(){return t(a.i(h.c)(e))})}};return l.a.createElement("div",null,l.a.createElement(c.a,o),l.a.createElement(i.a,{className:"y-m-b-40"},l.a.createElement(d.a,s)))}Object.defineProperty(t,"__esModule",{value:!0});var n=a(606),r=(a.n(n),a(605)),i=a.n(r),o=a(0),l=a.n(o),s=a(135),m=a(246),p=(a(11),a(33)),c=a(604),u=a(28),d=a(647),h=a(136);t.default=a.i(s.a)(function(e){return{information:e.information,app:e.app}})(InformationEdit)},604:function(e,t,a){"use strict";function newBreadcrumb(e){var t=e.breadcrumbs;return l.a.createElement(i.a,{separator:">",style:{marginBottom:"20px"}},t.map(function(e,t){return l.a.createElement(i.a.Item,{key:t},m.a.isStringNotEmpty(e.href)?l.a.createElement(s.Link,{to:e.href},e.name):e.name)}))}var n=a(611),r=(a.n(n),a(610)),i=a.n(r),o=a(0),l=a.n(o),s=a(73),m=a(11);t.a=newBreadcrumb},623:function(e,t,a){"use strict";var n=a(242),r=a.n(n),i=a(30),o=a.n(i),l=a(243),s=a.n(l),m=a(32),p=a.n(m),c=a(31),u=a.n(c),d=a(0),h=a.n(d),f=a(140),g=a(625),v=(a.n(g),a(3)),E=a(637),b=(a.n(E),void 0),y=function(e){function Editor(e){o()(this,Editor);var t=p()(this,(Editor.__proto__||r()(Editor)).call(this,e));return t.state={},t}return u()(Editor,e),s()(Editor,[{key:"componentDidMount",value:function(){var e=this,t=this.props.id;b=new wangEditor(t),b.config.menus=wangEditor.config.menus.map(function(e,t){return"video"===e?null:"location"===e?null:"insertcode"===e?null:e}),b.config.uploadImgUrl=a.i(v.b)()+"/property/image/upload",b.config.withCredentials=!1,b.create();var n=b;b.$txt.html(this.props.html),b.onchange=function(){var a=n.$txt.html();e.props.handleEditor(t,a)}}},{key:"componentWillReceiveProps",value:function(e){var t=this,a=this.props.id,n=b;b.$txt.html(e.html),b.onchange=function(){var e=n.$txt.html();t.props.handleEditor(a,e)}}},{key:"render",value:function(){var e={width:"100%",height:"200px"};return h.a.createElement("div",null,h.a.createElement("div",{id:this.props.id,style:e,contentEditable:"true"}))}}]),Editor}(h.a.Component);t.a=a.i(f.connect)(function(e){return{editor:e.editor}})(y)},624:function(e,t,a){t=e.exports=a(42)(!1),t.push([e.i,"",""])},625:function(e,t,a){var n=a(624);"string"==typeof n&&(n=[[e.i,n,""]]);a(43)(n,{});n.locals&&(e.exports=n.locals)},647:function(e,t,a){"use strict";var n=a(133),r=(a.n(n),a(90)),i=a.n(r),o=a(614),l=(a.n(o),a(613)),s=a.n(l),m=a(245),p=(a.n(m),a(244)),c=a.n(p),u=a(618),d=(a.n(u),a(617)),h=a.n(d),f=a(600),g=(a.n(f),a(603)),v=a.n(g),E=a(602),b=(a.n(E),a(601)),y=a.n(b),_=a(1),k=a.n(_),w=a(134),C=(a.n(w),a(44)),I=a.n(C),F=a(608),S=(a.n(F),a(607)),V=a.n(S),x=a(14),D=(a.n(x),a(13)),U=a.n(D),q=a(242),A=a.n(q),P=a(30),B=a.n(P),j=a(243),L=a.n(j),O=a(32),$=a.n(O),T=a(31),M=a.n(T),N=a(0),z=a.n(N),R=(a(136),a(623)),W=[],G="",J=function(e){function InformationAdd(e){B()(this,InformationAdd);var t=$()(this,(InformationAdd.__proto__||A()(InformationAdd)).call(this,e));return t.state={name:"",file:"",previewImage:"",previewVisible:!1,isUpload:!0},t.props.img_url,G=t.props.intro,t}return M()(InformationAdd,e),L()(InformationAdd,[{key:"componentDidMount",value:function(){}},{key:"handleSubmit",value:function(){var e=this;this.props.form.validateFields(function(t,a){if(!t){var n="";0!=a.image.length&&(void 0!=a.image[0].response?n=a.image[0].response.data.imgPath+a.image[0].response.data.message:""!=a.image&&(n=a.image[0].url));var r=e.props.id,i="";if(G=G.replace(new RegExp("<p><br></p>"),""),i=G,""==G)return U.a.error("资讯内容不能为空"),!1;e.props.onOk({id:r,image:n,channel_id:a.channel_id,column_id:a.column_id,intro:i,is_reco:a.is_reco,keywords:a.keywords,label_ids:a.label_ids,name:a.name,shows:a.shows,sort_order:a.sort_order,summary:a.summary},e.props.form.resetFields)}})}},{key:"handleCancel",value:function(){this.props.onCancel(),this.props.form.resetFields(),this.setState({isUpload:!0})}},{key:"handlePreview",value:function(e){this.setState({previewImage:e.url||e.thumbUrl,previewVisible:!0})}},{key:"beforeUpload",value:function(e){var t="image/jpeg"===e.type,a="image/png"===e.type;if("image/jpg"!==e.type&&!t&&!a)return U.a.error("只能上传.jpeg,.jpg,.png图片"),!1;if(!(e.size/1024/1024<2))return U.a.error("请上传小于 2MB 的图片!"),!1;var n=(new Date).getTime(),r=e.type.split("/");this.setState({name:"jiazhuanghoutai/"+n+"."+r[1],files:e})}},{key:"modalCancel",value:function(){this.setState({previewVisible:!1})}},{key:"normFile",value:function(e){return Array.isArray(e)?e:e&&e.fileList}},{key:"handImgChange",value:function(e){e.fileList.length?this.props.uploadImg(!1):this.props.uploadImg(!0),"error"==e.file.status&&U.a.error("很遗憾...这次上传失败了。")}},{key:"handleChangeChannels",value:function(e){this.props.form.resetFields(["column_id","label_ids"]),this.props.changeSelectChannels(e)}},{key:"handleChangecolumn",value:function(e){var t=this.props.form.getFieldValue("channel_id");this.props.form.resetFields(["label_ids"]),this.props.changeSelectcolumn({channel_id:t,column_id:e})}},{key:"componentWillReceiveProps",value:function(e){this.props.intro!=e.intro&&(G=e.intro),W=[],e.labellist.map(function(e,t){return W.push(z.a.createElement(V.a.Option,{key:t,value:String(e.id)},e.name))})}},{key:"handleEditor",value:function(e,t){G=t}},{key:"render",value:function(){console.log(this.props.isUpload,1111);var e={labelCol:{span:6},wrapperCol:{span:18}},t=z.a.createElement("div",null,z.a.createElement(I.a,{type:"plus"}),z.a.createElement("div",{className:"ant-upload-text"},"选择图片"));return z.a.createElement(y.a,null,z.a.createElement(y.a.Item,k()({label:"所属频道"},e),this.props.form.getFieldDecorator("channel_id",{initialValue:this.props.channel_id,rules:[{required:!0,message:"请选择所属频道!"}]})(z.a.createElement(V.a,{placeholder:"请选择",onChange:this.handleChangeChannels.bind(this)},this.props.selectChannels.map(function(e,t){return z.a.createElement(V.a.Option,{key:t,value:String(e.channel_id)},e.channel_name)})))),z.a.createElement(y.a.Item,k()({label:"所属栏目"},e),this.props.form.getFieldDecorator("column_id",{initialValue:this.props.column_id,rules:[{message:"请选择所属栏目!"}]})(z.a.createElement(V.a,{placeholder:"请先选择栏目",onChange:this.handleChangecolumn.bind(this)},this.props.selectColumns.map(function(e,t){return z.a.createElement(V.a.Option,{key:String(t),value:String(e.column_id)},e.column_name)})))),z.a.createElement(y.a.Item,k()({label:"关联标签"},e),this.props.form.getFieldDecorator("label_ids",{initialValue:this.props.label_ids})(z.a.createElement(V.a,{mode:"multiple",placeholder:"请先选择栏目"},W))),z.a.createElement(y.a.Item,k()({label:"资讯标题"},e),this.props.form.getFieldDecorator("name",{initialValue:this.props.name,rules:[{required:!0,message:"请输入资讯标题"}]})(z.a.createElement(v.a,{placeholder:"请输入资讯标题"}))),z.a.createElement(y.a.Item,k()({label:"资讯主图"},e),this.props.form.getFieldDecorator("image",{initialValue:this.props.image,valuePropName:"fileList",normalize:this.normFile,onChange:this.handImgChange.bind(this),rules:[{required:!0,message:"请上传资讯主图!"}]})(z.a.createElement(h.a,{action:"http://up.qiniu.com/",data:{token:this.props.uploadToken,key:this.state.name,file:this.state.files},onPreview:this.handlePreview.bind(this),listType:"picture-card",beforeUpload:this.beforeUpload.bind(this)},this.props.isUpload?t:null))),z.a.createElement(c.a,{visible:this.state.previewVisible,footer:null,onCancel:this.modalCancel.bind(this)},z.a.createElement("img",{alt:"example",style:{width:"100%"},src:this.state.previewImage})),z.a.createElement(y.a.Item,k()({label:"资讯摘要"},e),this.props.form.getFieldDecorator("summary",{initialValue:this.props.summary,rules:[{required:!0,message:"请输入资讯摘要!"}]})(z.a.createElement(v.a,{type:"textarea",rows:4,maxLength:200,placeholder:"请输入资讯摘要"}))),z.a.createElement(y.a.Item,k()({},e,{label:"资讯内容",hasFeedback:!0,required:!0}),this.props.form.getFieldDecorator("editor1")(z.a.createElement(R.a,{html:G,handleEditor:this.handleEditor}))),z.a.createElement(y.a.Item,k()({label:"浏览量"},e),this.props.form.getFieldDecorator("shows",{initialValue:this.props.shows,rules:[{message:"请输入浏览量!",pattern:/^\d+$/}]})(z.a.createElement(v.a,{placeholder:"请输入浏览量"}))),z.a.createElement(y.a.Item,k()({label:"关键词"},e),this.props.form.getFieldDecorator("keywords",{initialValue:this.props.keywords,rules:[{message:"请输入关键词!"}]})(z.a.createElement(v.a,{placeholder:"请输入关键词"}))),z.a.createElement(y.a.Item,k()({},e,{label:"推荐到首页",required:!0}),this.props.form.getFieldDecorator("is_reco",{rules:[{required:!0,message:"请选择状态"}],initialValue:this.props.is_reco})(z.a.createElement(s.a.Group,null,z.a.createElement(s.a,{value:"1"},"是"),z.a.createElement(s.a,{value:"2"},"否")))),z.a.createElement(y.a.Item,k()({label:"排序"},e),this.props.form.getFieldDecorator("sort_order",{initialValue:this.props.sort_order,rules:[{required:!0,message:"请输入排序!",pattern:/^[0-9]*[1-9][0-9]*$/}]})(z.a.createElement(v.a,{placeholder:"请输入排序"}))),z.a.createElement(y.a.Item,{wrapperCol:{span:22,offset:3}},z.a.createElement(i.a,{type:"primary",onClick:this.handleSubmit.bind(this),loading:this.props.formSureButton},"提交"),z.a.createElement(i.a,{type:"ghost",style:{marginLeft:"30px"},onClick:this.handleCancel.bind(this)},"返回")))}}]),InformationAdd}(z.a.Component);J=y.a.create({})(J),t.a=J}});